import{r as l,v as C,j as e,B as a,T as t,b as u}from"./index-DElIqkCb.js";import{u as ae,M as ie,U as F,b as oe}from"./useVoiceQueries-CcLYD6x7.js";import{a as b}from"./types-CKC1yxAr.js";import{G as R}from"./Grid-D43hy5Rk.js";import{C as S,a as U,I as V,P as E}from"./List-DOmlK0d2.js";import{A as G}from"./Alert-Dtjzj-4q.js";import{S as ne,P as ce}from"./Stop-iolxOc2U.js";import{C as H,L,a as x,R as le}from"./Refresh-CKyXwQvz.js";import{D as de}from"./Delete-B71UJHN9.js";import{D as ue}from"./Divider-FsvPJCCZ.js";import{S as $}from"./Stack-pui1Cubj.js";import{T as xe}from"./Tooltip-CCJechNg.js";import"./validation-lkrWou_x.js";import"./TextField-BQGW9zaC.js";import"./DialogTitle-CQP44rHO.js";const Ie=()=>{const[w,I]=l.useState(!1),[n,P]=l.useState(!1),[p,B]=l.useState(null),[D,y]=l.useState(""),[s,m]=l.useState(null),[A,h]=l.useState(null),[q,f]=l.useState(0),[N,g]=l.useState(!1),[M,O]=l.useState([]),k=C.useRef(null),j=C.useRef(null),v=C.useRef(null),{useTranscribeAudio:W,useParseVoice:_,useCreateTaskFromVoice:Q}=ae(),J=W(),K=_(),X=Q(),Y=async()=>{try{const r=await navigator.mediaDevices.getUserMedia({audio:!0}),c=new MediaRecorder(r);k.current=c;const d=[];c.ondataavailable=i=>{d.push(i.data)},c.onstop=()=>{const i=new Blob(d,{type:"audio/wav"});B(i),r.getTracks().forEach(o=>o.stop())},c.start(),I(!0),f(0),v.current=setInterval(()=>{f(i=>i+1)},1e3)}catch{h("Microphone access denied. Please allow microphone access and try again.")}},Z=()=>{k.current&&w&&(k.current.stop(),I(!1),v.current&&clearInterval(v.current))},T=async(r="transcribe")=>{var c,d;if(p){P(!0),h(null);try{const i=new File([p],"recording.wav",{type:"audio/wav"});if(r==="transcribe"){const o=await J.mutateAsync({audioFile:i});y(o.data.text)}else if(r==="parse"){const o=await K.mutateAsync({audioFile:i});y(o.data.transcribedText),m(o.data.parsedTask)}else if(r==="create"){const o=await X.mutateAsync({audioFile:i});y(o.data.transcribedText),m(o.data.parsedTask),O(se=>[{id:Date.now(),task:o.data.task,transcription:o.data.transcribedText,timestamp:new Date},...se]),z()}}catch(i){h(((d=(c=i.response)==null?void 0:c.data)==null?void 0:d.message)||"Failed to process audio. Please try again.")}finally{P(!1)}}},z=()=>{B(null),y(""),m(null),h(null),f(0)},ee=()=>{if(p&&j.current){const r=URL.createObjectURL(p);j.current.src=r,j.current.play()}},re=r=>{const c=Math.floor(r/60),d=r%60;return`${c}:${d.toString().padStart(2,"0")}`},te=r=>{console.log("Creating task from parsed data:",r),g(!1),m(null)};return e.jsxs(a,{sx:{p:3},children:[e.jsx(t,{variant:"h4",gutterBottom:!0,children:"Voice Input"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Use your voice to create tasks quickly and efficiently. The AI will automatically extract details like title, deadline, priority, and duration from your speech."}),e.jsxs(R,{container:!0,spacing:3,children:[e.jsx(R,{item:!0,xs:12,md:8,children:e.jsx(S,{children:e.jsxs(U,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Voice Recording"}),A&&e.jsx(G,{severity:"error",sx:{mb:2},children:A}),e.jsxs(a,{display:"flex",alignItems:"center",gap:2,mb:2,children:[w?e.jsxs(u,{variant:"contained",color:"error",startIcon:e.jsx(ne,{}),onClick:Z,size:"large",children:["Stop Recording (",re(q),")"]}):e.jsx(u,{variant:"contained",color:"primary",startIcon:e.jsx(ie,{}),onClick:Y,disabled:n,size:"large",children:"Start Recording"}),p&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outlined",startIcon:e.jsx(ce,{}),onClick:ee,disabled:n,children:"Play"}),e.jsx(u,{variant:"outlined",color:"primary",onClick:()=>T("transcribe"),disabled:n,startIcon:e.jsx(F,{}),children:n?"Processing...":"Transcribe Only"}),e.jsx(u,{variant:"outlined",color:"secondary",onClick:()=>T("parse"),disabled:n,startIcon:e.jsx(F,{}),children:n?"Processing...":"Parse Task"}),e.jsx(u,{variant:"contained",color:"success",onClick:()=>T("create"),disabled:n,startIcon:e.jsx(H,{}),children:n?"Creating...":"Create Task"}),e.jsx(V,{color:"error",onClick:z,disabled:n,children:e.jsx(de,{})})]})]}),n&&e.jsxs(a,{mb:2,children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Processing audio..."}),e.jsx(L,{})]}),e.jsx("audio",{ref:j,style:{display:"none"}}),D&&e.jsxs(a,{mb:2,children:[e.jsx(ue,{sx:{mb:2}}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Transcription:"}),e.jsx(E,{sx:{p:2,bgcolor:"grey.50"},children:e.jsx(t,{variant:"body1",children:D})})]}),s&&e.jsxs(a,{mb:2,children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Parsed Task Details:"}),e.jsx(S,{variant:"outlined",sx:{p:2},children:e.jsxs($,{spacing:2,children:[e.jsxs(a,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Title:"}),e.jsx(t,{variant:"body1",children:s.title})]}),e.jsxs(a,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Description:"}),e.jsx(t,{variant:"body1",children:s.description})]}),e.jsxs(a,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(x,{label:`Priority: ${s.priority}`,color:s.priority===b.URGENT?"error":s.priority===b.HIGH?"warning":"default",size:"small"}),e.jsx(x,{label:`Category: ${s.category}`,color:"primary",size:"small"}),s.time_required&&e.jsx(x,{label:`Duration: ${s.time_required}m`,color:"info",size:"small"}),s.deadline&&e.jsx(x,{label:`Deadline: ${new Date(s.deadline).toLocaleString()}`,color:"secondary",size:"small"})]}),e.jsxs(a,{children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Confidence: ",Math.round(s.confidence*100),"%"]}),e.jsx(L,{variant:"determinate",value:s.confidence*100,sx:{mt:1}})]}),e.jsx(u,{variant:"contained",onClick:()=>g(!0),startIcon:e.jsx(H,{}),children:"Create Task from Parsed Data"})]})})]}),e.jsxs(a,{mt:2,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:e.jsx("strong",{children:"Instructions:"})}),e.jsx(t,{variant:"body2",color:"text.secondary",children:'• Click "Start Recording" to begin voice input'}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"• Speak clearly and describe your task naturally"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"• Include details like deadline, priority, and duration"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:'• Click "Stop Recording" when finished'}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"• Choose to transcribe, parse, or create task directly"})]})]})})}),e.jsx(R,{item:!0,xs:12,md:4,children:e.jsx(S,{children:e.jsxs(U,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(t,{variant:"h6",children:"Recent Voice Tasks"}),e.jsx(xe,{title:"Refresh",children:e.jsx(V,{size:"small",children:e.jsx(le,{})})})]}),M.length===0?e.jsx(G,{severity:"info",children:"No voice-created tasks yet. Start recording to create your first task!"}):e.jsx($,{spacing:2,children:M.slice(0,5).map(r=>e.jsxs(E,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:r.task.title}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:['"',r.transcription,'"']}),e.jsxs(a,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(x,{size:"small",label:r.task.priority,color:r.task.priority===b.URGENT?"error":r.task.priority===b.HIGH?"warning":"default"}),e.jsx(x,{size:"small",label:r.task.category,color:"primary"})]}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:r.timestamp.toLocaleString()})]},r.id))})]})})})]}),e.jsx(oe,{open:N,onClose:()=>g(!1),onSubmit:te,initialData:s,title:"Create Task from Voice Input"})]})};export{Ie as default};
//# sourceMappingURL=VoicePage--5hH3rj9.js.map
