import{j as e,r as b,B as n,T as t,b as J,v as ee}from"./index-pyrP4BMh.js";import{u as se}from"./useTaskQueries-Dyn3x2M3.js";import{T as C,L as P}from"./Tooltip-CS9G8SJn.js";import{c as L,I as v,P as k,C as x,a as h,L as F}from"./List-CAw70JoQ.js";import{R as H,L as V,a as j,C as te}from"./Refresh-uSvqQb4a.js";import{G as i}from"./Grid-C5_dhhtu.js";import{S as W,E as z}from"./Schedule-DCJfQHC7.js";import{P as A,S as ne}from"./Stop-BWhsmn6_.js";import{S}from"./Stack-DGPHLbVX.js";import{T as re,a as ie,b as ae,c as $,d as r,e as le,S as ce}from"./Settings-B2Jo51qR.js";import{L as G,a as N}from"./ListItemText-Ck79eKkQ.js";import{D as oe}from"./Divider-ColTxRJ8.js";import{a as de,c as ue,b as xe,D as he}from"./DialogTitle-Zceb_dXp.js";import{T as je}from"./TrendingUp-DO1NaoXj.js";const O=L(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),B=L(e.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),me=L(e.jsx("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),ze=()=>{const[g,Q]=b.useState(0),[U,R]=b.useState(!1),[a,q]=b.useState(null),[Z,K]=b.useState(!0),{useGetReminderStats:X}=se(),{data:pe}=X(),c=[{id:"1",name:"Deadline Reminder Check",type:"cron",schedule:"*/30 * * * *",status:"running",lastRun:"2024-01-15T10:30:00Z",nextRun:"2024-01-15T11:00:00Z",successCount:245,failureCount:2,avgDuration:"150ms",description:"Checks for upcoming deadlines and sends reminder emails"},{id:"2",name:"Overdue Task Check",type:"cron",schedule:"10 * * * *",status:"running",lastRun:"2024-01-15T10:10:00Z",nextRun:"2024-01-15T11:10:00Z",successCount:168,failureCount:0,avgDuration:"89ms",description:"Identifies overdue tasks and sends notifications"},{id:"3",name:"Daily Summary",type:"cron",schedule:"0 9 * * *",status:"running",lastRun:"2024-01-15T09:00:00Z",nextRun:"2024-01-16T09:00:00Z",successCount:15,failureCount:0,avgDuration:"2.3s",description:"Sends daily task summary emails to users"},{id:"4",name:"Email Queue Processor",type:"queue",schedule:"continuous",status:"running",lastRun:"2024-01-15T10:45:00Z",nextRun:"continuous",successCount:1234,failureCount:12,avgDuration:"45ms",description:"Processes outgoing email queue"},{id:"5",name:"Database Cleanup",type:"cron",schedule:"0 2 * * 0",status:"paused",lastRun:"2024-01-14T02:00:00Z",nextRun:"2024-01-21T02:00:00Z",successCount:8,failureCount:1,avgDuration:"15.2s",description:"Cleans up old logs and temporary data"}],T=[{id:"1",jobId:"1",status:"success",startedAt:"2024-01-15T10:30:00Z",completedAt:"2024-01-15T10:30:00.150Z",duration:"150ms",result:"Sent 3 reminder emails"},{id:"2",jobId:"2",status:"success",startedAt:"2024-01-15T10:10:00Z",completedAt:"2024-01-15T10:10:00.089Z",duration:"89ms",result:"Found 0 overdue tasks"},{id:"3",jobId:"4",status:"error",startedAt:"2024-01-15T10:45:00Z",completedAt:"2024-01-15T10:45:00.200Z",duration:"200ms",result:"Failed to send email: Invalid recipient"}],m=b.useMemo(()=>{const s=c.length,l=c.filter(u=>u.status==="running").length,o=c.filter(u=>u.status==="paused").length,p=c.filter(u=>u.status==="failed").length,d=c.reduce((u,D)=>u+D.successCount,0),f=c.reduce((u,D)=>u+D.failureCount,0),y=d+f>0?d/(d+f)*100:0;return{totalJobs:s,runningJobs:l,pausedJobs:o,failedJobs:p,totalSuccess:d,totalFailures:f,successRate:y}},[c]),w=(s,l)=>{console.log(`Job ${s} action: ${l}`)},Y=s=>{q(s),R(!0)},E=s=>{if(s==="continuous")return"Continuous";if(s==="manual")return"Manual";const l=s.split(" ");if(l.length===5){const[o,p,d,f,y]=l;if(o==="*/30"&&p==="*"&&d==="*"&&f==="*"&&y==="*")return"Every 30 minutes";if(o==="10"&&p==="*"&&d==="*"&&f==="*"&&y==="*")return"Every hour at 10 minutes";if(o==="0"&&p==="9"&&d==="*"&&f==="*"&&y==="*")return"Daily at 9:00 AM";if(o==="0"&&p==="2"&&d==="*"&&f==="*"&&y==="0")return"Weekly on Sunday at 2:00 AM"}return s},M=s=>{switch(s){case"running":return"success";case"paused":return"warning";case"failed":return"error";case"success":return"success";case"error":return"error";default:return"default"}},I=s=>{switch(s){case"running":return e.jsx(A,{});case"paused":return e.jsx(B,{});case"failed":return e.jsx(z,{});case"success":return e.jsx(te,{});case"error":return e.jsx(z,{});default:return e.jsx(O,{})}},_=[{label:"Overview",icon:e.jsx(je,{})},{label:"Active Jobs",icon:e.jsx(W,{})},{label:"Job History",icon:e.jsx(me,{})},{label:"Settings",icon:e.jsx(ce,{})}];return e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(t,{variant:"h4",children:"Background Jobs"}),e.jsxs(n,{display:"flex",gap:1,children:[e.jsx(C,{title:"Auto Refresh",children:e.jsx(v,{color:Z?"primary":"default",onClick:()=>K(!Z),children:e.jsx(H,{})})}),e.jsx(J,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>window.location.reload(),children:"Refresh All"})]})]}),e.jsx(k,{sx:{mb:3},children:e.jsx(n,{display:"flex",gap:1,p:1,children:_.map((s,l)=>e.jsx(J,{variant:g===l?"contained":"text",startIcon:s.icon,onClick:()=>Q(l),sx:{minWidth:120},children:s.label},l))})}),g===0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(h,{children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(W,{color:"primary",sx:{mr:2,fontSize:40}}),e.jsxs(n,{children:[e.jsx(t,{variant:"h4",children:m.totalJobs}),e.jsx(t,{color:"text.secondary",children:"Total Jobs"})]})]})})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(h,{children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(A,{color:"success",sx:{mr:2,fontSize:40}}),e.jsxs(n,{children:[e.jsx(t,{variant:"h4",children:m.runningJobs}),e.jsx(t,{color:"text.secondary",children:"Running"})]})]})})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(h,{children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(B,{color:"warning",sx:{mr:2,fontSize:40}}),e.jsxs(n,{children:[e.jsx(t,{variant:"h4",children:m.pausedJobs}),e.jsx(t,{color:"text.secondary",children:"Paused"})]})]})})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(h,{children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(z,{color:"error",sx:{mr:2,fontSize:40}}),e.jsxs(n,{children:[e.jsx(t,{variant:"h4",children:m.failedJobs}),e.jsx(t,{color:"text.secondary",children:"Failed"})]})]})})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(x,{children:e.jsxs(h,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Success Rate"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(V,{variant:"determinate",value:m.successRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(t,{variant:"h6",children:[m.successRate.toFixed(1),"%"]})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[m.totalSuccess," successful, ",m.totalFailures," failed"]})]})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(x,{children:e.jsxs(h,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"System Health"}),e.jsxs(S,{spacing:1,children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{children:"Cron Scheduler"}),e.jsx(j,{label:"Healthy",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{children:"Email Queue"}),e.jsx(j,{label:"Healthy",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{children:"Database"}),e.jsx(j,{label:"Healthy",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{children:"Memory Usage"}),e.jsx(t,{children:"45%"})]})]})]})})})]}),g===1&&e.jsx(x,{children:e.jsxs(h,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Active Jobs"}),e.jsx(re,{children:e.jsxs(ie,{children:[e.jsx(ae,{children:e.jsxs($,{children:[e.jsx(r,{children:"Job Name"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Schedule"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Last Run"}),e.jsx(r,{children:"Next Run"}),e.jsx(r,{children:"Success Rate"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(le,{children:c.map(s=>e.jsxs($,{children:[e.jsx(r,{children:e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",children:s.name}),e.jsx(t,{variant:"caption",color:"text.secondary",children:s.description})]})}),e.jsx(r,{children:e.jsx(j,{label:s.type,color:s.type==="cron"?"primary":"secondary",size:"small"})}),e.jsx(r,{children:E(s.schedule)}),e.jsx(r,{children:e.jsx(j,{icon:I(s.status),label:s.status,color:M(s.status),size:"small"})}),e.jsx(r,{children:new Date(s.lastRun).toLocaleString()}),e.jsx(r,{children:s.nextRun==="continuous"?"Continuous":new Date(s.nextRun).toLocaleString()}),e.jsx(r,{children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs(t,{variant:"body2",children:[s.successCount,"/",s.successCount+s.failureCount]}),e.jsx(V,{variant:"determinate",value:s.successCount/(s.successCount+s.failureCount)*100,sx:{width:50,height:4}})]})}),e.jsxs(r,{children:[e.jsx(C,{title:"View Details",children:e.jsx(v,{size:"small",onClick:()=>Y(s),children:e.jsx(O,{})})}),s.status==="running"?e.jsx(C,{title:"Pause Job",children:e.jsx(v,{size:"small",onClick:()=>w(s.id,"pause"),children:e.jsx(B,{})})}):e.jsx(C,{title:"Start Job",children:e.jsx(v,{size:"small",onClick:()=>w(s.id,"start"),children:e.jsx(A,{})})}),e.jsx(C,{title:"Stop Job",children:e.jsx(v,{size:"small",color:"error",onClick:()=>w(s.id,"stop"),children:e.jsx(ne,{})})})]})]},s.id))})]})})]})}),g===2&&e.jsx(x,{children:e.jsxs(h,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Recent Job Executions"}),e.jsx(F,{children:T.map((s,l)=>{var o;return e.jsxs(ee.Fragment,{children:[e.jsxs(P,{children:[e.jsx(G,{children:I(s.status)}),e.jsx(N,{primary:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{variant:"subtitle2",children:((o=c.find(p=>p.id===s.jobId))==null?void 0:o.name)||"Unknown Job"}),e.jsx(j,{label:s.status,color:M(s.status),size:"small"})]}),secondary:e.jsxs(n,{children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Started: ",new Date(s.startedAt).toLocaleString()]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Duration: ",s.duration," | Result: ",s.result]})]})})]}),l<T.length-1&&e.jsx(oe,{})]},s.id)})})]})}),g===3&&e.jsx(x,{children:e.jsxs(h,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Job Scheduler Settings"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(k,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Scheduler Configuration"}),e.jsxs(S,{spacing:1,children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Max Concurrent Jobs:"}),e.jsx(t,{children:"5"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Job Timeout (minutes):"}),e.jsx(t,{children:"30"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Retry Failed Jobs:"}),e.jsx(j,{label:"Enabled",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Max Retries:"}),e.jsx(t,{children:"3"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Log Level:"}),e.jsx(t,{children:"INFO"})]})]})]})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsxs(k,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Monitoring"}),e.jsxs(S,{spacing:1,children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Health Check Interval:"}),e.jsx(t,{children:"5 minutes"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Alert on Failures:"}),e.jsx(j,{label:"Enabled",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Performance Monitoring:"}),e.jsx(j,{label:"Enabled",color:"success",size:"small"})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{children:"Log Retention:"}),e.jsx(t,{children:"30 days"})]})]})]})})]})]})}),e.jsxs(de,{open:U,onClose:()=>R(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(ue,{children:["Job Details: ",a==null?void 0:a.name]}),e.jsx(xe,{children:a&&e.jsxs(S,{spacing:2,children:[e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Description"}),e.jsx(t,{variant:"body2",children:a.description})]}),e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Schedule"}),e.jsx(t,{variant:"body2",children:E(a.schedule)})]}),e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Statistics"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Success Count: ",a.successCount]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Failure Count: ",a.failureCount]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Average Duration: ",a.avgDuration]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Success Rate: ",(a.successCount/(a.successCount+a.failureCount)*100).toFixed(1),"%"]})})]})]}),e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Recent Executions"}),e.jsx(F,{dense:!0,children:T.filter(s=>s.jobId===a.id).slice(0,5).map(s=>e.jsxs(P,{children:[e.jsx(G,{children:I(s.status)}),e.jsx(N,{primary:new Date(s.startedAt).toLocaleString(),secondary:`${s.duration} - ${s.result}`})]},s.id))})]})]})}),e.jsx(he,{children:e.jsx(J,{onClick:()=>R(!1),children:"Close"})})]})]})};export{ze as default};
//# sourceMappingURL=JobsPage-CMiIXF8S.js.map
